
# Тестирование приложения поиска вакансий

## Обзор

Данная директория содержит полный набор тестов для приложения поиска вакансий. Все тесты написаны с использованием pytest и не выполняют реальных запросов к внешним API или чтения из stdin.

## Структура тестов

### Основные тестовые модули

- `test_api_modules.py` - Тесты API модулей (HeadHunter, SuperJob, Unified API)
- `test_storage.py` - Тесты хранилища данных (PostgreSQL)
- `test_db_manager.py` - Тесты менеджера базы данных
- `test_vacancy_formatter.py` - Тесты форматирования вакансий
- `test_ui_helpers.py` - Тесты UI помощников
- `test_integration.py` - Интеграционные тесты
- `test_main_functionality.py` - Основные функциональные тесты

### Конфигурация тестов

- `conftest.py` - Общие фикстуры и настройки
- `pytest.ini` - Конфигурация pytest

## Фикстуры

### Основные фикстуры

- `sample_vacancy` - Образец тестовой вакансии
- `sample_vacancies` - Коллекция тестовых вакансий
- `mock_storage` - Мокированное хранилище
- `mock_db_manager` - Мокированный DBManager
- `mock_api_response` - Мокированный ответ API

### Автоматические моки

Все внешние ресурсы автоматически мокируются:
- HTTP запросы (requests.get, requests.post)
- Подключения к базе данных (psycopg2.connect)
- Пользовательский ввод (builtins.input)
- Файловые операции
- Переменные окружения

## Запуск тестов

### Все тесты
```bash
pytest
```

### Конкретный модуль
```bash
pytest tests/test_api_modules.py
```

### С покрытием кода
```bash
pytest --cov=src --cov-report=term-missing
```

### Только юнит-тесты
```bash
pytest -m "not integration"
```

### Только интеграционные тесты
```bash
pytest -m integration
```

## Принципы тестирования

### 1. Изоляция
- Все тесты изолированы друг от друга
- Не используются реальные внешние ресурсы
- Каждый тест может выполняться независимо

### 2. Мокирование
- Все внешние зависимости мокируются
- Моки настроены для имитации реального поведения
- Нет сетевых запросов или файловых операций

### 3. Покрытие
- Тесты покрывают основную функциональность
- Проверяются как положительные, так и отрицательные сценарии
- Тестируется обработка ошибок

### 4. Читаемость
- Тесты имеют понятные названия
- Используются докстринги для описания
- Код тестов структурирован и понятен

## Добавление новых тестов

При добавлении новых тестов:

1. Используйте существующие фикстуры из `conftest.py`
2. Мокируйте все внешние зависимости
3. Следуйте соглашениям по именованию
4. Добавляйте докстринги
5. Группируйте связанные тесты в классы

## Отладка тестов

Для отладки провалившихся тестов:

```bash
# Подробный вывод
pytest -v

# Остановка на первой ошибке
pytest -x

# Показать локальные переменные
pytest -l

# Подробная трассировка
pytest --tb=long
```

## Проверка качества кода

```bash
# Покрытие кода
pytest --cov=src --cov-report=html

# Проверка стиля кода (если настроено)
flake8 tests/

# Проверка типов (если используется mypy)
mypy tests/
```
