~/workspace$ pytest tests/ --cov=src --cov-report=html
===================================== test session starts ======================================
platform linux -- Python 3.11.13, pytest-8.4.1, pluggy-1.6.0 -- /nix/store/2lcqw1d28vklbk8ikiwad28iq2smwndv-python-wrapped-0.1.0/bin/python3
cachedir: .pytest_cache
rootdir: /home/runner/workspace/tests
configfile: pytest.ini
plugins: cov-6.2.1, mock-3.14.1
collected 74 items                                                                             

tests/test_api_modules.py::TestHeadHunterAPI::test_api_initialization PASSED             [  1%]
tests/test_api_modules.py::TestHeadHunterAPI::test_validate_vacancy_valid PASSED         [  2%]
tests/test_api_modules.py::TestHeadHunterAPI::test_validate_vacancy_invalid PASSED       [  4%]
tests/test_api_modules.py::TestHeadHunterAPI::test_get_vacancies_page_success PASSED     [  5%]
tests/test_api_modules.py::TestHeadHunterAPI::test_get_vacancies_empty_response PASSED   [  6%]
tests/test_api_modules.py::TestHeadHunterAPI::test_empty_response_structure PASSED       [  8%]
tests/test_api_modules.py::TestSuperJobAPI::test_api_initialization_with_custom_key PASSED [  9%]
tests/test_api_modules.py::TestSuperJobAPI::test_validate_vacancy_valid PASSED           [ 10%]
tests/test_api_modules.py::TestSuperJobAPI::test_validate_vacancy_invalid PASSED         [ 12%]
tests/test_api_modules.py::TestSuperJobAPI::test_get_vacancies_page_with_source PASSED   [ 13%]
tests/test_api_modules.py::TestSuperJobAPI::test_empty_response_structure PASSED         [ 14%]
tests/test_integration.py::TestIntegrationWorkflow::test_complete_vacancy_workflow_json PASSED [ 16%]
tests/test_integration.py::TestIntegrationWorkflow::test_search_and_filter_integration PASSED [ 17%]
tests/test_integration.py::TestIntegrationWorkflow::test_error_handling_integration PASSED [ 18%]
tests/test_integration.py::TestIntegrationWorkflow::test_api_to_storage_integration FAILED [ 20%]
tests/test_storage.py::TestJSONSaver::test_add_vacancy_to_empty_file FAILED              [ 21%]
tests/test_storage.py::TestJSONSaver::test_add_duplicate_vacancy PASSED                  [ 22%]
tests/test_storage.py::TestJSONSaver::test_get_vacancies_empty_file PASSED               [ 24%]
tests/test_storage.py::TestJSONSaver::test_delete_vacancy_by_id PASSED                   [ 25%]
tests/test_storage.py::TestJSONSaver::test_delete_nonexistent_vacancy PASSED             [ 27%]
tests/test_storage.py::TestJSONSaver::test_delete_all_vacancies PASSED                   [ 28%]
tests/test_storage.py::TestJSONSaver::test_file_size_calculation PASSED                  [ 29%]
tests/test_storage.py::TestPostgresSaver::test_connection_creation PASSED                [ 31%]
tests/test_storage.py::TestPostgresSaver::test_add_vacancy_success FAILED                [ 32%]
tests/test_storage.py::TestPostgresSaver::test_get_vacancies_count PASSED                [ 33%]
tests/test_storage.py::TestPostgresSaver::test_delete_vacancy_by_id_success PASSED       [ 35%]
tests/test_storage.py::TestPostgresSaver::test_delete_vacancy_by_id_not_found PASSED     [ 36%]
tests/test_ui_helpers.py::TestUIHelpers::test_get_positive_integer_valid PASSED          [ 37%]
tests/test_ui_helpers.py::TestUIHelpers::test_get_positive_integer_invalid_then_valid FAILED [ 39%]
tests/test_ui_helpers.py::TestUIHelpers::test_get_positive_integer_non_numeric PASSED    [ 40%]
tests/test_ui_helpers.py::TestUIHelpers::test_filter_vacancies_by_keyword_in_title PASSED [ 41%]
tests/test_ui_helpers.py::TestUIHelpers::test_filter_vacancies_by_keyword_in_description PASSED [ 43%]
tests/test_ui_helpers.py::TestUIHelpers::test_filter_vacancies_by_keyword_case_insensitive PASSED [ 44%]
tests/test_ui_helpers.py::TestUIHelpers::test_filter_vacancies_by_keyword_no_matches PASSED [ 45%]
tests/test_ui_helpers.py::TestUIHelpers::test_parse_salary_range_both_values PASSED      [ 47%]
tests/test_ui_helpers.py::TestUIHelpers::test_parse_salary_range_only_min PASSED         [ 48%]
tests/test_ui_helpers.py::TestUIHelpers::test_parse_salary_range_only_max PASSED         [ 50%]
tests/test_ui_helpers.py::TestUIHelpers::test_parse_salary_range_single_value PASSED     [ 51%]
tests/test_ui_helpers.py::TestUIHelpers::test_parse_salary_range_invalid_format PASSED   [ 52%]
tests/test_ui_helpers.py::TestUIHelpers::test_parse_salary_range_empty_string PASSED     [ 54%]
tests/test_ui_helpers.py::TestUIHelpers::test_parse_salary_range_with_spaces PASSED      [ 55%]
tests/test_vacancy_formatter.py::TestVacancyFormatter::test_format_vacancy_info_basic PASSED [ 56%]
tests/test_vacancy_formatter.py::TestVacancyFormatter::test_format_vacancy_info_no_number PASSED [ 58%]
tests/test_vacancy_formatter.py::TestVacancyFormatter::test_format_salary_with_range PASSED [ 59%]
tests/test_vacancy_formatter.py::TestVacancyFormatter::test_format_salary_only_from PASSED [ 60%]
tests/test_vacancy_formatter.py::TestVacancyFormatter::test_format_salary_none PASSED    [ 62%]
tests/test_vacancy_formatter.py::TestVacancyFormatter::test_format_company_info_dict PASSED [ 63%]
tests/test_vacancy_formatter.py::TestVacancyFormatter::test_format_company_info_string PASSED [ 64%]
tests/test_vacancy_formatter.py::TestVacancyFormatter::test_format_company_info_none PASSED [ 66%]
tests/test_vacancy_formatter.py::TestVacancyFormatter::test_extract_responsibilities PASSED [ 67%]
tests/test_vacancy_formatter.py::TestVacancyFormatter::test_extract_requirements PASSED  [ 68%]
tests/test_vacancy_formatter.py::TestVacancyFormatter::test_extract_conditions_with_schedule PASSED [ 70%]
tests/test_vacancy_formatter.py::TestVacancyFormatter::test_build_vacancy_lines_complete PASSED [ 71%]
tests/test_vacancy_formatter.py::TestVacancyFormatter::test_convert_hh_api_url_to_web_url PASSED [ 72%]
tests/test_vacancy_models.py::TestVacancy::test_vacancy_creation_with_dict_salary PASSED [ 74%]
tests/test_vacancy_models.py::TestVacancy::test_vacancy_creation_without_salary PASSED   [ 75%]
tests/test_vacancy_models.py::TestVacancy::test_vacancy_string_representation PASSED     [ 77%]
tests/test_vacancy_models.py::TestVacancy::test_vacancy_comparison PASSED                [ 78%]
tests/test_vacancy_models.py::TestVacancy::test_vacancy_equality PASSED                  [ 79%]
tests/test_vacancy_models.py::TestSalary::test_salary_creation_from_dict PASSED          [ 81%]
tests/test_vacancy_models.py::TestSalary::test_salary_string_representation PASSED       [ 82%]
tests/test_vacancy_models.py::TestSalary::test_salary_only_from PASSED                   [ 83%]
tests/test_vacancy_models.py::TestSalary::test_salary_only_to PASSED                     [ 85%]
tests/test_vacancy_models.py::TestSalary::test_salary_comparison PASSED                  [ 86%]
tests/test_vacancy_models.py::TestSalary::test_source_detection_from_dict PASSED         [ 87%]
tests/test_vacancy_models.py::TestSalary::test_source_fallback_detection PASSED          [ 89%]
tests/test_vacancy_operations.py::TestVacancyOperations::test_get_vacancies_with_salary FAILED [ 90%]
tests/test_vacancy_operations.py::TestVacancyOperations::test_sort_vacancies_by_salary PASSED [ 91%]
tests/test_vacancy_operations.py::TestVacancyOperations::test_filter_vacancies_by_multiple_keywords FAILED [ 93%]
tests/test_vacancy_operations.py::TestVacancyOperations::test_search_vacancies_advanced_and_operator FAILED [ 94%]
tests/test_vacancy_operations.py::TestVacancyOperations::test_search_vacancies_advanced_or_operator FAILED [ 95%]
tests/test_vacancy_operations.py::TestVacancyOperations::test_search_vacancies_advanced_simple_query FAILED [ 97%]
tests/test_vacancy_operations.py::TestVacancyOperations::test_calculate_vacancy_relevance FAILED [ 98%]
tests/test_vacancy_operations.py::TestVacancyOperations::test_calculate_vacancy_relevance_no_matches FAILED [100%]

=========================================== FAILURES ===========================================
___________________ TestIntegrationWorkflow.test_api_to_storage_integration ____________________
tests/test_integration.py:212: in test_api_to_storage_integration
    assert len(parsed_vacancies) == 1
E   assert 0 == 1
E    +  where 0 = len([])
------------------------------------- Captured stderr call -------------------------------------
Fetching pages: 100%|██████████| 1/1 [00:00<00:00, 3070.50page/s, vacancies=1]
_________________________ TestJSONSaver.test_add_vacancy_to_empty_file _________________________
tests/test_storage.py:29: in test_add_vacancy_to_empty_file
    assert data[0]['vacancy_id'] == '12345'
           ^^^^^^^^^^^^^^^^^^^^^
E   KeyError: 'vacancy_id'
__________________________ TestPostgresSaver.test_add_vacancy_success __________________________
tests/test_storage.py:142: in test_add_vacancy_success
    messages = saver.add_vacancy(sample_vacancy)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
src/storage/postgres_saver.py:248: in add_vacancy
    execute_values(cursor, insert_query, insert_data, template=None, page_size=100)
.pythonlibs/lib/python3.11/site-packages/psycopg2/extras.py:1287: in execute_values
    sql = sql.encode(_ext.encodings[cur.connection.encoding])
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   KeyError: <Mock name='connect().cursor().connection.encoding' id='139974874760272'>
__________________ TestUIHelpers.test_get_positive_integer_invalid_then_valid __________________
tests/test_ui_helpers.py:31: in test_get_positive_integer_invalid_then_valid
    assert result == 15
E   assert None == 15
_____________________ TestVacancyOperations.test_get_vacancies_with_salary _____________________
tests/test_vacancy_operations.py:78: in test_get_vacancies_with_salary
    vacancy_without_salary = Vacancy(
E   TypeError: Vacancy.__init__() missing 1 required positional argument: 'url'
_______________ TestVacancyOperations.test_filter_vacancies_by_multiple_keywords _______________
tests/test_vacancy_operations.py:102: in test_filter_vacancies_by_multiple_keywords
    Vacancy(title="Python Django Developer", vacancy_id="1"),
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   TypeError: Vacancy.__init__() missing 1 required positional argument: 'url'
______________ TestVacancyOperations.test_search_vacancies_advanced_and_operator _______________
tests/test_vacancy_operations.py:126: in test_search_vacancies_advanced_and_operator
    Vacancy(title="Senior Python Developer", description="Django REST API", vacancy_id="1"),
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   TypeError: Vacancy.__init__() missing 1 required positional argument: 'url'
_______________ TestVacancyOperations.test_search_vacancies_advanced_or_operator _______________
tests/test_vacancy_operations.py:140: in test_search_vacancies_advanced_or_operator
    Vacancy(title="Python Developer", vacancy_id="1"),
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   TypeError: Vacancy.__init__() missing 1 required positional argument: 'url'
______________ TestVacancyOperations.test_search_vacancies_advanced_simple_query _______________
tests/test_vacancy_operations.py:156: in test_search_vacancies_advanced_simple_query
    Vacancy(title="Python Developer", vacancy_id="1"),
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E   TypeError: Vacancy.__init__() missing 1 required positional argument: 'url'
____________________ TestVacancyOperations.test_calculate_vacancy_relevance ____________________
tests/test_vacancy_operations.py:168: in test_calculate_vacancy_relevance
    vacancy = Vacancy(
E   TypeError: Vacancy.__init__() missing 1 required positional argument: 'url'
______________ TestVacancyOperations.test_calculate_vacancy_relevance_no_matches _______________
tests/test_vacancy_operations.py:184: in test_calculate_vacancy_relevance_no_matches
    vacancy = Vacancy(
E   TypeError: Vacancy.__init__() missing 1 required positional argument: 'url'
======================================== tests coverage ========================================
_______________________ coverage: platform linux, python 3.11.13-final-0 _______________________

Coverage HTML written to dir htmlcov
=================================== short test summary info ====================================
FAILED tests/test_integration.py::TestIntegrationWorkflow::test_api_to_storage_integration - assert 0 == 1
FAILED tests/test_storage.py::TestJSONSaver::test_add_vacancy_to_empty_file - KeyError: 'vacancy_id'
FAILED tests/test_storage.py::TestPostgresSaver::test_add_vacancy_success - KeyError: <Mock name='connect().cursor().connection.encoding' id='139974874760272'>
FAILED tests/test_ui_helpers.py::TestUIHelpers::test_get_positive_integer_invalid_then_valid - assert None == 15
FAILED tests/test_vacancy_operations.py::TestVacancyOperations::test_get_vacancies_with_salary - TypeError: Vacancy.__init__() missing 1 required positional argument: 'url'
FAILED tests/test_vacancy_operations.py::TestVacancyOperations::test_filter_vacancies_by_multiple_keywords - TypeError: Vacancy.__init__() missing 1 required positional argument: 'url'
FAILED tests/test_vacancy_operations.py::TestVacancyOperations::test_search_vacancies_advanced_and_operator - TypeError: Vacancy.__init__() missing 1 required positional argument: 'url'
FAILED tests/test_vacancy_operations.py::TestVacancyOperations::test_search_vacancies_advanced_or_operator - TypeError: Vacancy.__init__() missing 1 required positional argument: 'url'
FAILED tests/test_vacancy_operations.py::TestVacancyOperations::test_search_vacancies_advanced_simple_query - TypeError: Vacancy.__init__() missing 1 required positional argument: 'url'
FAILED tests/test_vacancy_operations.py::TestVacancyOperations::test_calculate_vacancy_relevance - TypeError: Vacancy.__init__() missing 1 required positional argument: 'url'
FAILED tests/test_vacancy_operations.py::TestVacancyOperations::test_calculate_vacancy_relevance_no_matches - TypeError: Vacancy.__init__() missing 1 required positional argument: 'url'
================================ 11 failed, 63 passed in 0.82s =================================
~/workspace$ 