~/workspace$ pytest tests/test_43_vacancy_operations_coverage.py
=================================== test session starts ====================================
platform linux -- Python 3.11.13, pytest-8.4.2, pluggy-1.6.0
rootdir: /home/runner/workspace
configfile: pyproject.toml
plugins: cov-6.2.1, mock-3.15.0
collected 36 items                                                                         

tests/test_43_vacancy_operations_coverage.py ...............................FFFFF    [100%]

========================================= FAILURES =========================================
____ TestVacancyOperationsUncoveredLines.test_search_vacancies_by_keyword_empty_keyword ____

self = <tests.test_43_vacancy_operations_coverage.TestVacancyOperationsUncoveredLines object at 0x7fc5fc444250>

    def test_search_vacancies_by_keyword_empty_keyword(self):
        """Покрытие строк 320-321: пустое ключевое слово"""
        vacancies = [MockVacancy(title="Python Developer")]
    
        # Тестируем пустую строку
>       result = VacancyOperations.search_vacancies_by_keyword(None, vacancies, "")
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests/test_43_vacancy_operations_coverage.py:640: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

vacancies = None
keyword = [<tests.test_43_vacancy_operations_coverage.MockVacancy object at 0x7fc5fc2bc890>]
use_sql = ''

    @staticmethod
    def search_vacancies_by_keyword(
        vacancies: List[Vacancy], keyword: str, use_sql: bool = True
    ) -> List[Vacancy]:
        """
        Поиск вакансий по ключевому слову в названии или описании
        Поддерживает как SQL-поиск (быстрый), так и Python-поиск (для данных из API)
    
        Args:
            vacancies: Список вакансий для поиска
            keyword: Ключевое слово для поиска
            use_sql: Использовать SQL-поиск через БД (по умолчанию True)
    
        Returns:
            List[Vacancy]: Список найденных вакансий
        """
>       if not keyword or not keyword.strip():
                              ^^^^^^^^^^^^^
E       AttributeError: 'list' object has no attribute 'strip'

src/utils/vacancy_operations.py:321: AttributeError
_____ TestVacancyOperationsUncoveredLines.test_search_vacancies_by_keyword_sql_success _____

self = <tests.test_43_vacancy_operations_coverage.TestVacancyOperationsUncoveredLines object at 0x7fc5fc447f10>
mock_logger = <MagicMock name='logger' id='140488316142736'>

    @patch('src.utils.vacancy_operations.logger')
    def test_search_vacancies_by_keyword_sql_success(self, mock_logger):
        """Покрытие строк 324-333: успешный SQL поиск"""
        vacancies = [MockVacancy(title="Test")]
        mock_results = [MockVacancy(title="SQL Result")]
    
        # Мокируем успешный PostgresSaver
        with patch('src.storage.postgres_saver.PostgresSaver') as mock_postgres_class:
            mock_postgres_instance = MagicMock()
            mock_postgres_instance.search_vacancies_batch.return_value = mock_results
            mock_postgres_class.return_value = mock_postgres_instance
    
>           result = VacancyOperations.search_vacancies_by_keyword(None, vacancies, "python", use_sql=True)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E           TypeError: VacancyOperations.search_vacancies_by_keyword() got multiple values for argument 'use_sql'

tests/test_43_vacancy_operations_coverage.py:663: TypeError
------------------------------------ Captured log call -------------------------------------
WARNING  src.utils.env_loader:env_loader.py:36 Файл .env не найден в следующих местах: ['.env']
WARNING  src.utils.env_loader:env_loader.py:37 Используются переменные окружения системы.
___ TestVacancyOperationsUncoveredLines.test_search_vacancies_by_keyword_sql_no_results ____

self = <tests.test_43_vacancy_operations_coverage.TestVacancyOperationsUncoveredLines object at 0x7fc5fc445450>
mock_logger = <MagicMock name='logger' id='140488312565840'>

    @patch('src.utils.vacancy_operations.logger')
    def test_search_vacancies_by_keyword_sql_no_results(self, mock_logger):
        """Покрытие строк 324-340: SQL поиск без результатов"""
        vacancies = [MockVacancy(title="Test")]
    
        # Мокируем PostgresSaver без результатов
        with patch('src.storage.postgres_saver.PostgresSaver') as mock_postgres_class:
            mock_postgres_instance = MagicMock()
            mock_postgres_instance.search_vacancies_batch.return_value = []  # Пустой результат
            mock_postgres_class.return_value = mock_postgres_instance
    
>           result = VacancyOperations.search_vacancies_by_keyword(None, vacancies, "python", use_sql=True)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E           TypeError: VacancyOperations.search_vacancies_by_keyword() got multiple values for argument 'use_sql'

tests/test_43_vacancy_operations_coverage.py:680: TypeError
____ TestVacancyOperationsUncoveredLines.test_search_vacancies_by_keyword_sql_exception ____

self = <tests.test_43_vacancy_operations_coverage.TestVacancyOperationsUncoveredLines object at 0x7fc5fc44a110>
mock_logger = <MagicMock name='logger' id='140488313403600'>

    @patch('src.utils.vacancy_operations.logger')
    def test_search_vacancies_by_keyword_sql_exception(self, mock_logger):
        """Покрытие строк 334-337: исключение при SQL поиске"""
        vacancies = [MockVacancy(title="Test")]
    
        # Мокируем PostgresSaver с исключением
        with patch('src.storage.postgres_saver.PostgresSaver') as mock_postgres_class:
            mock_postgres_class.side_effect = Exception("Database connection failed")
    
>           result = VacancyOperations.search_vacancies_by_keyword(None, vacancies, "python", use_sql=True)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E           TypeError: VacancyOperations.search_vacancies_by_keyword() got multiple values for argument 'use_sql'

tests/test_43_vacancy_operations_coverage.py:694: TypeError
____ TestVacancyOperationsUncoveredLines.test_search_vacancies_by_keyword_sql_disabled _____

self = <tests.test_43_vacancy_operations_coverage.TestVacancyOperationsUncoveredLines object at 0x7fc5fc448e50>

    def test_search_vacancies_by_keyword_sql_disabled(self):
        """Покрытие строк 339-340: SQL поиск отключен"""
        vacancies = [MockVacancy(title="Test")]
    
        # Отключаем SQL поиск
>       result = VacancyOperations.search_vacancies_by_keyword(None, vacancies, "python", use_sql=False)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       TypeError: VacancyOperations.search_vacancies_by_keyword() got multiple values for argument 'use_sql'

tests/test_43_vacancy_operations_coverage.py:706: TypeError
================================= short test summary info ==================================
FAILED tests/test_43_vacancy_operations_coverage.py::TestVacancyOperationsUncoveredLines::test_search_vacancies_by_keyword_empty_keyword - AttributeError: 'list' object has no attribute 'strip'
FAILED tests/test_43_vacancy_operations_coverage.py::TestVacancyOperationsUncoveredLines::test_search_vacancies_by_keyword_sql_success - TypeError: VacancyOperations.search_vacancies_by_keyword() got multiple values for argu...
FAILED tests/test_43_vacancy_operations_coverage.py::TestVacancyOperationsUncoveredLines::test_search_vacancies_by_keyword_sql_no_results - TypeError: VacancyOperations.search_vacancies_by_keyword() got multiple values for argu...
FAILED tests/test_43_vacancy_operations_coverage.py::TestVacancyOperationsUncoveredLines::test_search_vacancies_by_keyword_sql_exception - TypeError: VacancyOperations.search_vacancies_by_keyword() got multiple values for argu...
FAILED tests/test_43_vacancy_operations_coverage.py::TestVacancyOperationsUncoveredLines::test_search_vacancies_by_keyword_sql_disabled - TypeError: VacancyOperations.search_vacancies_by_keyword() got multiple values for argu...
=============================== 5 failed, 31 passed in 0.65s ===============================
~/workspace$ 