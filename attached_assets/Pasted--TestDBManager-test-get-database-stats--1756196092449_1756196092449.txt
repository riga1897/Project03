______________________________________ TestDBManager.test_get_database_stats ______________________________________

self = <tests.test_db_manager.TestDBManager object at 0x7f4b779e1190>
mock_connect = <MagicMock name='connect' id='139962105248336'>
db_manager = <src.storage.db_manager.DBManager object at 0x7f4b7790afd0>

    @patch('src.storage.db_manager.psycopg2.connect')
    def test_get_database_stats(self, mock_connect, db_manager):
        """Тест получения статистики БД"""
        mock_connection = Mock()
        mock_cursor = Mock()
        mock_connect.return_value = mock_connection
        mock_connection.__enter__ = Mock(return_value=mock_connection)
        mock_connection.__exit__ = Mock(return_value=None)
        mock_cursor_context = Mock()
        mock_cursor_context.__enter__ = Mock(return_value=mock_cursor)
        mock_cursor_context.__exit__ = Mock(return_value=None)
        mock_connection.cursor.return_value = mock_cursor_context
    
        # Имитируем результаты разных запросов - возвращаем кортежи
        mock_cursor.fetchone.side_effect = [(100,), (15,), (75,), ('2024-01-15',)]
    
        result = db_manager.get_database_stats()
    
>       assert result['total_vacancies'] == 100
               ^^^^^^^^^^^^^^^^^^^^^^^^^
E       KeyError: 'total_vacancies'

tests/test_db_manager.py:279: KeyError
---------------------------------------------- Captured stderr call -----------------------------------------------
ERROR:src.storage.db_manager:Неожиданная ошибка при получении статистики БД: cannot convert dictionary update sequence element #0 to a sequence
------------------------------------------------ Captured log call ------------------------------------------------
ERROR    src.storage.db_manager:db_manager.py:649 Неожиданная ошибка при получении статистики БД: cannot convert dictionary update sequence element #0 to a sequence
============================================= short test summary info =============================================
FAILED tests/test_db_manager.py::TestDBManager::test_get_database_stats - KeyError: 'total_vacancies'
==================================== 1 failed, 181 passed, 2 skipped in 0.83s =====================================
