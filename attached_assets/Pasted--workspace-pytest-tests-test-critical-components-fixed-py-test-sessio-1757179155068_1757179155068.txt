~/workspace$ pytest tests/test_critical_components_fixed.py
=========================== test session starts ============================
platform linux -- Python 3.11.13, pytest-8.4.2, pluggy-1.6.0
rootdir: /home/runner/workspace
configfile: pyproject.toml
plugins: cov-6.2.1, mock-3.15.0
collected 22 items                                                         

tests/test_critical_components_fixed.py ....FF................       [100%]

================================= FAILURES =================================
____ TestPostgresSaverFixed.test_save_vacancies_with_real_object_fixed _____

args = (<tests.test_critical_components_fixed.TestPostgresSaverFixed object at 0x7f97474dd690>,)
keywargs = {'mock_postgres_connection': (<MagicMock id='140287713707536'>, <MagicMock id='140287713707152'>), 'mock_real_vacancy'...cancy object at 0x7f9749626a90>, 'postgres_saver': <src.storage.postgres_saver.PostgresSaver object at 0x7f974750d990>}

    @wraps(func)
    def patched(*args, **keywargs):
>       with self.decoration_helper(patched,
                                    args,
                                    keywargs) as (newargs, newkeywargs):

/nix/store/7d088dip86hlzri9sk0h78b63yfmx0a0-python3-3.11.13/lib/python3.11/unittest/mock.py:1375: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
/nix/store/7d088dip86hlzri9sk0h78b63yfmx0a0-python3-3.11.13/lib/python3.11/contextlib.py:137: in __enter__
    return next(self.gen)
           ^^^^^^^^^^^^^^
/nix/store/7d088dip86hlzri9sk0h78b63yfmx0a0-python3-3.11.13/lib/python3.11/unittest/mock.py:1357: in decoration_helper
    arg = exit_stack.enter_context(patching)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/nix/store/7d088dip86hlzri9sk0h78b63yfmx0a0-python3-3.11.13/lib/python3.11/contextlib.py:517: in enter_context
    result = _enter(cm)
             ^^^^^^^^^^
/nix/store/7d088dip86hlzri9sk0h78b63yfmx0a0-python3-3.11.13/lib/python3.11/unittest/mock.py:1446: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <unittest.mock._patch object at 0x7f97474d0490>

    def get_original(self):
        target = self.getter()
        name = self.attribute
    
        original = DEFAULT
        local = False
    
        try:
            original = target.__dict__[name]
        except (AttributeError, KeyError):
            original = getattr(target, name, DEFAULT)
        else:
            local = True
    
        if name in _builtins and isinstance(target, ModuleType):
            self.create = True
    
        if not self.create and original is DEFAULT:
>           raise AttributeError(
                "%s does not have the attribute %r" % (target, name)
            )
E           AttributeError: <tests.conftest.MockPsycopg2Extras object at 0x7f9747b8d090> does not have the attribute 'execute_values'

/nix/store/7d088dip86hlzri9sk0h78b63yfmx0a0-python3-3.11.13/lib/python3.11/unittest/mock.py:1419: AttributeError
__________ TestPostgresSaverFixed.test_delete_vacancy_by_id_fixed __________

self = <tests.test_critical_components_fixed.TestPostgresSaverFixed object at 0x7f97474ddd10>
mock_connect = <MagicMock name='connect' id='140287712414224'>
postgres_saver = <src.storage.postgres_saver.PostgresSaver object at 0x7f974745c210>
mock_postgres_connection = (<MagicMock name='connect()' id='140287707796240'>, <MagicMock id='140287707803856'>)

    @patch('psycopg2.connect')
    def test_delete_vacancy_by_id_fixed(self, mock_connect, postgres_saver, mock_postgres_connection):
        """Исправленный тест удаления вакансии по ID"""
        if not POSTGRES_SAVER_AVAILABLE:
            return
    
        mock_conn, mock_cursor = mock_postgres_connection
        mock_connect.return_value = mock_conn
    
        # Правильно настраиваем rowcount как свойство
        type(mock_cursor).rowcount = Mock(return_value=1)
        mock_cursor.rowcount = 1
    
        with patch.object(postgres_saver, '_get_connection', return_value=mock_conn):
            if hasattr(postgres_saver, 'delete_vacancy_by_id'):
>               result = postgres_saver.delete_vacancy_by_id('test123')
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests/test_critical_components_fixed.py:251: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 

self = <src.storage.postgres_saver.PostgresSaver object at 0x7f974745c210>
vacancy_id = 'test123'

    def delete_vacancy_by_id(self, vacancy_id: str) -> bool:
        """Удаляет вакансию по ID"""
        connection = self._get_connection()
        try:
            cursor = connection.cursor()
            cursor.execute("DELETE FROM vacancies WHERE vacancy_id = %s", (vacancy_id,))
    
>           if cursor.rowcount > 0:
               ^^^^^^^^^^^^^^^^^^^
E           TypeError: '>' not supported between instances of 'MagicMock' and 'int'

src/storage/postgres_saver.py:1001: TypeError
========================= short test summary info ==========================
FAILED tests/test_critical_components_fixed.py::TestPostgresSaverFixed::test_save_vacancies_with_real_object_fixed - AttributeError: <tests.conftest.MockPsycopg2Extras object at 0x7f9747b8...
FAILED tests/test_critical_components_fixed.py::TestPostgresSaverFixed::test_delete_vacancy_by_id_fixed - TypeError: '>' not supported between instances of 'MagicMock' and 'int'
======================= 2 failed, 20 passed in 0.56s =======================
~/workspace$ 