
# Архитектура системы поиска вакансий

## Общая архитектура

Проект построен на модульной архитектуре с четким разделением ответственности между компонентами. Система использует паттерны проектирования для обеспечения расширяемости и поддержки.

```
┌─────────────────────────────────────────────────────────────┐
│                    ПОЛЬЗОВАТЕЛЬСКИЙ СЛОЙ                    │
├─────────────────────────────────────────────────────────────┤
│  ConsoleInterface  │  VacancyDisplayHandler  │  MenuManager  │
└─────────────────────┬───────────────────────┬───────────────┘
                      │                       │
┌─────────────────────┴───────────────────────┴───────────────┐
│                     БИЗНЕС-ЛОГИКА                          │
├─────────────────────────────────────────────────────────────┤
│  VacancyOperations  │  SearchUtils  │  VacancyFormatter    │
└─────────────────────┬───────────────┬─────────────────────┘
                      │               │
┌─────────────────────┴───────────────┴─────────────────────┐
│                    API СЛОЙ                               │
├─────────────────────────────────────────────────────────────┤
│  UnifiedAPI  │  HeadHunterAPI  │  SuperJobAPI  │  CachedAPI │
└─────────────────────┬───────────────────────┬───────────────┘
                      │                       │
┌─────────────────────┴───────────────────────┴───────────────┐
│                   СЛОЙ ДАННЫХ                              │
├─────────────────────────────────────────────────────────────┤
│  PostgresSaver  │  Vacancy Model  │  Salary  │  DB Manager │
└─────────────────────────────────────────────────────────────┘
```

## Ключевые принципы

### 1. Разделение ответственности (SRP)
Каждый модуль отвечает за конкретную область функциональности:
- **API модули** - взаимодействие с внешними сервисами
- **Storage модули** - управление данными
- **UI модули** - пользовательский интерфейс
- **Utils модули** - вспомогательные функции

### 2. Принцип открытости/закрытости (OCP)
Система легко расширяется без модификации существующего кода:
- Новые источники API добавляются через наследование от `BaseJobAPI`
- Расширение функциональности PostgreSQL через наследование от `AbstractVacancyStorage`ver`
- Новые форматы отображения - через `BaseFormatter`

### 3. Принцип инверсии зависимостей (DIP)
Высокоуровневые модули не зависят от низкоуровневых:
- Используются абстрактные интерфейсы
- Зависимости внедряются через конструкторы
- Конфигурация вынесена в отдельные модули

## Слои системы

### Пользовательский слой
**Назначение**: Взаимодействие с пользователем

**Компоненты**:
- `ConsoleInterface` - основной консольный интерфейс
- `VacancyDisplayHandler` - отображение вакансий
- `MenuManager` - управление меню
- `SourceSelector` - выбор источников данных

**Особенности**:
- Отделен от бизнес-логики
- Легко заменяем (можно добавить веб-интерфейс)
- Использует паттерн Command для обработки команд

### Бизнес-логика
**Назначение**: Основная логика обработки данных

**Компоненты**:
- `VacancyOperations` - операции с вакансиями
- `SearchUtils` - утилиты поиска
- `VacancyFormatter` - форматирование данных
- `Paginator` - пагинация результатов

**Особенности**:
- Независим от способа хранения и отображения
- Содержит алгоритмы поиска и фильтрации
- Обеспечивает валидацию данных

### API слой
**Назначение**: Взаимодействие с внешними API

**Компоненты**:
- `BaseJobAPI` - абстрактный базовый класс
- `HeadHunterAPI` - клиент для HH.ru
- `SuperJobAPI` - клиент для SuperJob.ru
- `UnifiedAPI` - единый интерфейс
- `CachedAPI` - кэширование запросов

**Особенности**:
- Единый интерфейс для всех источников
- Автоматическое кэширование
- Обработка ошибок и повторные попытки
- Дедупликация результатов

### Слой данных
**Назначение**: Управление данными и их хранение

**Компоненты**:
- `AbstractSaver` - абстрактный интерфейс хранения
- `PostgresSaver` - хранение в PostgreSQL
- `JSONSaver` - хранение в JSON файлах
- `Vacancy` - модель вакансии
- `Salary` - модель зарплаты

**Особенности**:
- Поддержка нескольких способов хранения
- Batch операции для производительности
- Автоматическая миграция схемы
- Оптимизированные запросы

## Паттерны проектирования

### Factory Pattern
Используется для создания объектов хранилища:
```python
class StorageFactory:
    @staticmethod
    def create_saver(storage_type: str) -> AbstractSaver:
        # Создание нужного типа хранилища
```

### Strategy Pattern
Для выбора алгоритма отображения данных:
```python
class VacancyFormatter:
    def format(self, vacancies: List[Vacancy], format_type: str):
        # Выбор стратегии форматирования
```

### Template Method Pattern
В базовых классах API для определения общего алгоритма:
```python
class BaseJobAPI:
    def get_vacancies(self, query: str):
        # Общий алгоритм с вызовом специфичных методов
```

### Observer Pattern
Для уведомлений о прогрессе операций:
```python
class Paginator:
    def paginate(self, fetch_func, total_pages):
        # Уведомления о прогрессе
```

## Конфигурация и настройки

### Модульная конфигурация
Каждый компонент имеет свой конфигурационный класс:
- `APIConfig` - настройки API
- `DatabaseConfig` - настройки БД
- `UIConfig` - настройки интерфейса

### Переменные окружения
Система поддерживает конфигурацию через переменные окружения для:
- Подключения к базе данных
- API ключей
- Параметров кэширования

## Обработка ошибок

### Многоуровневая обработка
1. **API уровень** - обработка сетевых ошибок
2. **Бизнес-логика** - валидация данных
3. **UI уровень** - отображение ошибок пользователю

### Логирование
Структурированное логирование на всех уровнях:
- Уровень DEBUG для отладки
- Уровень INFO для общей информации
- Уровень ERROR для ошибок

## Производительность

### Кэширование
- Кэш API запросов с TTL
- Кэш результатов поиска
- Кэш форматированных данных

### Оптимизация БД
- Индексы на часто используемые поля
- Batch операции для массовых изменений
- Prepared statements для безопасности

### Пагинация
- Lazy loading больших наборов данных
- Конфигурируемый размер страницы
- Эффективная навигация
